# Phase 4: Predictive Analytics

**Ğ¦ĞµĞ»ÑŒ:** ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ°ÑĞ¾Ğ², Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ñƒ  
**Ğ¡Ñ€Ğ¾Ğº:** 3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ (Week 8-10)  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… MVP Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½  
**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 2026-01-31  
**Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ MVP:** 2026-01-31

---

## 1. ĞĞ±Ğ·Ğ¾Ñ€

### 1.1 Deliverable

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¿Ñ€Ğ¾ÑĞ° Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ğ¿Ğ¾ Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ñƒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ¾ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ° Ğ¸Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ.

### 1.2 User Story

```
ĞšĞ°Ğº Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞºĞ»Ğ°Ğ´Ğ°,
Ñ Ñ…Ğ¾Ñ‡Ñƒ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ·Ğ°Ğ¿Ğ°ÑĞ¾Ğ² Ğ½Ğ° 7-30 Ğ´Ğ½ĞµĞ¹ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´,
Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¸ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ,
Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ stockout Ğ¸ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ.
```

### 1.3 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Predictive Analytics Flow                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“Š Transaction History                                                      â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ConsumptionService  â”‚â”€â”€â”€â”€â–¶â”‚ ForecastService                         â”‚   â”‚
â”‚  â”‚ (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)  â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ MVP: Simple Moving Average (SMA)   â”‚ â”‚   â”‚
â”‚                              â”‚ â”‚ v2:  Prophet (Python microservice) â”‚ â”‚   â”‚
â”‚                              â”‚ â”‚ v3:  AutoML (optional)             â”‚ â”‚   â”‚
â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚                             â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                 â–¼                            â–¼                    â–¼        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚        â”‚ ReorderService  â”‚       â”‚ Forecast API    â”‚    â”‚ ğŸ“ˆ Charts    â”‚  â”‚
â”‚        â”‚ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸)  â”‚       â”‚ (tRPC router)   â”‚    â”‚ (Recharts)   â”‚  â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                                                         â”‚
â”‚                 â–¼                                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚        â”‚ ğŸ“§ Proactive    â”‚                                               â”‚
â”‚        â”‚    Alerts       â”‚                                               â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° |
|---------|----------|---------|
| **MAPE** | Mean Absolute Percentage Error | Î£\|actual-forecast\|/actual / n |
| **Days to Stockout** | Ğ”Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ½ÑƒĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ° | current_qty / avg_daily_consumption |
| **Reorder Point** | Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ·Ğ°ĞºĞ°Ğ·Ğ° | lead_time_days Ã— avg_daily + safety_stock |
| **Safety Stock** | Ğ¡Ñ‚Ñ€Ğ°Ñ…Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ | z_score Ã— Ïƒ Ã— âˆšlead_time |

---

## 2. Tech Stack

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-----------|------------|--------|----------|
| **MVP Forecast** | Custom SMA | - | Simple Moving Average (JavaScript) |
| **Exponential Smoothing** | Custom EMA | - | Weighted recent data more |
| **Prophet** | `prophet` | ^1.x | Facebook's forecasting (Python) |
| **Charts** | `recharts` | ^2.x | Forecast visualization |
| **Date Utils** | `date-fns` | ^3.x | Date calculations |

### 2.1 ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´

**ĞŸĞ¾ÑÑ‚Ğ°Ğ¿Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**

1. **MVP (Week 1):** Simple Moving Average
   - Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ
   - ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑÑƒ
   - Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² ÑĞ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ¿Ñ€Ğ¾ÑĞ¾Ğ¼

2. **v2 (Week 2-3):** Prophet Microservice
   - ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞµĞ·Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ
   - Holidays (Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¸)
   - Ğ¢Ñ€ĞµĞ½Ğ´Ñ‹ Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸

3. **v3 (Future):** AutoML
   - Ğ”Ğ»Ñ enterprise ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
   - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

---

## 3. Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸

### 3.1 Ğ‘Ğ»Ğ¾Ğº 1: Data Aggregation Layer (Day 1-2)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 1.1 | ConsumptionService | `src/server/services/consumption-service.ts` | âœ… |
| 1.2 | Prisma: DailyConsumption model | `prisma/schema.prisma` | âœ… |
| 1.3 | Consumption aggregation job | `scripts/aggregate-consumption.ts` | âœ… |
| 1.4 | tRPC: getConsumptionHistory | `src/server/api/routers/forecast.ts` | âœ… |
| 1.5 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ConsumptionService | `src/__tests__/unit/consumption.test.ts` | â¬œ |

**Prisma Schema Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ:**

```prisma
// ============================================
// Phase 4: Ğ”Ğ½ĞµĞ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ)
// ============================================
model DailyConsumption {
  id          Int      @id @default(autoincrement())
  sku         String   @db.VarChar(50)
  warehouse   String   @db.VarChar(50)
  date        DateTime @db.Date
  consumed    Int      // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾/Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾
  received    Int      @default(0) // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ¸Ğ²ÑˆĞµĞ³Ğ¾
  netChange   Int      @map("net_change") // consumed - received
  avgPrice    Decimal? @map("avg_price") @db.Decimal(10, 2)
  
  @@unique([sku, warehouse, date])
  @@index([sku])
  @@index([warehouse])
  @@index([date])
  @@map("daily_consumption")
}

// ============================================
// Phase 4: ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹
// ============================================
model Forecast {
  id            Int       @id @default(autoincrement())
  sku           String    @db.VarChar(50)
  warehouse     String    @db.VarChar(50)
  forecastDate  DateTime  @map("forecast_date") @db.Date
  predictedQty  Int       @map("predicted_qty")
  confidenceLow Int?      @map("confidence_low")
  confidenceHigh Int?     @map("confidence_high")
  model         String    @db.VarChar(20) // "sma", "ema", "prophet"
  mape          Decimal?  @db.Decimal(5, 2) // Model accuracy
  createdAt     DateTime  @default(now()) @map("created_at")
  
  @@unique([sku, warehouse, forecastDate, model])
  @@index([sku])
  @@index([forecastDate])
  @@map("forecasts")
}

// ============================================
// Phase 4: Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ñƒ
// ============================================
model ReorderRecommendation {
  id              Int       @id @default(autoincrement())
  sku             String    @db.VarChar(50)
  warehouse       String    @db.VarChar(50)
  currentQty      Int       @map("current_qty")
  reorderPoint    Int       @map("reorder_point")
  recommendedQty  Int       @map("recommended_qty")
  daysToStockout  Int       @map("days_to_stockout")
  urgency         String    @db.VarChar(20) // "critical", "warning", "normal"
  status          String    @default("pending") @db.VarChar(20) // "pending", "approved", "ordered"
  expiresAt       DateTime  @map("expires_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  @@index([sku])
  @@index([urgency])
  @@index([status])
  @@map("reorder_recommendations")
}
```

---

### 3.2 Ğ‘Ğ»Ğ¾Ğº 2: MVP Forecasting (SMA/EMA) (Day 3-5)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 2.1 | ForecastService (SMA) | `src/server/services/forecast-service.ts` | âœ… |
| 2.2 | EMA implementation | `src/server/services/forecast-service.ts` | âœ… |
| 2.3 | Seasonality detection | `src/server/services/forecast-service.ts` | âœ… |
| 2.4 | tRPC: getForecast | `src/server/api/routers/forecast.ts` | âœ… |
| 2.5 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ForecastService | `src/__tests__/unit/forecast.test.ts` | âœ… |

**ForecastService API:**

```typescript
// src/server/services/forecast-service.ts

export interface ForecastInput {
  sku: string;
  warehouse: string;
  historyDays: number;     // Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ (30-90)
  forecastDays: number;    // ĞĞ° ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· (7-30)
  model: "sma" | "ema" | "prophet";
}

export interface ForecastResult {
  sku: string;
  warehouse: string;
  currentQty: number;
  forecasts: Array<{
    date: Date;
    predictedQty: number;
    confidenceLow?: number;
    confidenceHigh?: number;
  }>;
  daysToStockout: number;
  avgDailyConsumption: number;
  trend: "increasing" | "stable" | "decreasing";
  seasonality: boolean;
  mape?: number;           // Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹)
}

export class ForecastService {
  /**
   * Simple Moving Average
   * Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ´Ğ½ĞµĞ¹
   */
  calculateSMA(data: number[], window: number): number;

  /**
   * Exponential Moving Average
   * Ğ’Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ğ¾Ğµ ÑÑ€ĞµĞ´Ğ½ĞµĞµ (Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ)
   */
  calculateEMA(data: number[], smoothing: number): number;

  /**
   * Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
   */
  async forecast(input: ForecastInput): Promise<ForecastResult>;

  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ´ (Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚/Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚/ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾)
   */
  detectTrend(data: number[]): "increasing" | "stable" | "decreasing";

  /**
   * ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ñ‚ÑŒ ÑĞµĞ·Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ
   */
  detectSeasonality(data: number[]): boolean;
}
```

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹:**

```typescript
// Simple Moving Average
function simpleMovingAverage(data: number[], window: number): number {
  // Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿ÑƒÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ°
  if (data.length === 0) return 0;
  
  if (data.length < window) return data.reduce((a, b) => a + b, 0) / data.length;
  const slice = data.slice(-window);
  return slice.reduce((a, b) => a + b, 0) / slice.length;
}

// Exponential Moving Average
function exponentialMovingAverage(data: number[], smoothing = 0.3): number {
  // Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿ÑƒÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ°
  if (data.length === 0) return 0;
  
  return data.reduce((ema, value, index) => {
    if (index === 0) return value;
    return value * smoothing + ema * (1 - smoothing);
  }, data[0]!);
}

// Days to stockout
function daysToStockout(currentQty: number, avgDailyConsumption: number): number {
  if (avgDailyConsumption <= 0) return Infinity;
  return Math.floor(currentQty / avgDailyConsumption);
}

// Trend detection (linear regression slope)
function detectTrend(data: number[]): "increasing" | "stable" | "decreasing" {
  const n = data.length;
  
  // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 2 Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ‚Ñ€ĞµĞ½Ğ´Ğ°
  if (n < 2) return "stable";
  
  const sumX = (n * (n - 1)) / 2;
  const sumY = data.reduce((a, b) => a + b, 0);
  const sumXY = data.reduce((sum, y, x) => sum + x * y, 0);
  const sumX2 = (n * (n - 1) * (2 * n - 1)) / 6;
  
  const denominator = n * sumX2 - sumX * sumX;
  
  // Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ğ½Ğ¾Ğ»ÑŒ (Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸ n >= 2)
  if (denominator === 0) return "stable";
  
  const slope = (n * sumXY - sumX * sumY) / denominator;
  
  const threshold = 0.1; // 10% change per period
  if (slope > threshold) return "increasing";
  if (slope < -threshold) return "decreasing";
  return "stable";
}
```

---

### 3.3 Ğ‘Ğ»Ğ¾Ğº 3: Reorder Recommendations (Day 6-7)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 3.1 | ReorderService | `src/server/services/reorder-service.ts` | âœ… |
| 3.2 | Lead time configuration | `src/server/services/reorder-service.ts` | âœ… |
| 3.3 | Safety stock calculation | `src/server/services/reorder-service.ts` | âœ… |
| 3.4 | tRPC: getReorderRecommendations | `src/server/api/routers/forecast.ts` | âœ… |
| 3.5 | Recommendation approval flow | `src/server/api/routers/forecast.ts` | âœ… |
| 3.6 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ReorderService | `src/__tests__/unit/reorder.test.ts` | âœ… |

**ReorderService API:**

```typescript
// src/server/services/reorder-service.ts

export interface ReorderConfig {
  leadTimeDays: number;      // Ğ’Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ Ğ¾Ñ‚ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸ĞºĞ° (default: 7)
  serviceLevel: number;      // Ğ–ĞµĞ»Ğ°ĞµĞ¼Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑĞ° 0.90-0.99 (default: 0.95)
  reviewPeriodDays: number;  // ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ¿ĞµÑ€ĞµÑÑ‡Ñ‘Ñ‚Ğ° (default: 1)
  minOrderQty?: number;      // ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·
  maxOrderQty?: number;      // ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·
}

export interface ReorderRecommendation {
  sku: string;
  warehouse: string;
  productName: string;
  currentQty: number;
  reorderPoint: number;
  recommendedQty: number;
  optimalOrderQty: number;   // Economic Order Quantity
  daysToStockout: number;
  urgency: "critical" | "warning" | "normal";
  estimatedCost?: number;
  supplier?: string;
  reasoning: string;         // ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
}

export class ReorderService {
  /**
   * Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ·Ğ°ĞºĞ°Ğ·Ğ° (Reorder Point)
   * ROP = (avg_daily Ã— lead_time) + safety_stock
   */
  calculateReorderPoint(
    avgDailyConsumption: number,
    leadTimeDays: number,
    safetyStock: number
  ): number;

  /**
   * Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ
   * Safety Stock = Z Ã— Ïƒ Ã— âˆš(lead_time)
   * Z = 1.65 Ğ´Ğ»Ñ 95% service level
   */
  calculateSafetyStock(
    stdDevConsumption: number,
    leadTimeDays: number,
    serviceLevel: number
  ): number;

  /**
   * Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ·Ğ°ĞºĞ°Ğ·Ğ° (EOQ)
   * EOQ = âˆš(2 Ã— D Ã— S / H)
   * D = annual demand, S = order cost, H = holding cost
   */
  calculateEOQ(
    annualDemand: number,
    orderCost: number,
    holdingCostPerUnit: number
  ): number;

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
   */
  async getRecommendations(warehouse?: string): Promise<ReorderRecommendation[]>;

  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ
   */
  determineUrgency(daysToStockout: number, leadTimeDays: number): "critical" | "warning" | "normal";
}
```

**Urgency levels:**

| Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ | Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|---------|---------|----------|
| ğŸ”´ **critical** | daysToStockout â‰¤ leadTime | Ğ¡Ñ€Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·, email alert |
| ğŸŸ¡ **warning** | daysToStockout â‰¤ leadTime Ã— 1.5 | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ |
| ğŸŸ¢ **normal** | daysToStockout > leadTime Ã— 1.5 | ĞŸĞ»Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ· |

---

### 3.4 Ğ‘Ğ»Ğ¾Ğº 4: Forecast UI (Day 8-10)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 4.1 | Forecast Page | `src/app/forecast/page.tsx` | âœ… |
| 4.2 | ForecastChart component | `src/app/_components/forecast/ForecastChart.tsx` | âœ… |
| 4.3 | ReorderTable component | `src/app/_components/forecast/ReorderTable.tsx` | âœ… |
| 4.4 | ProductForecastCard | `src/app/_components/forecast/ProductForecastCard.tsx` | âœ… |
| 4.5 | TrendIndicator | `src/app/_components/forecast/TrendIndicator.tsx` | âœ… |
| 4.6 | ForecastSettings | `src/app/settings/forecast/page.tsx` | â¬œ |
| 4.7 | Dashboard integration | `src/app/_components/dashboard/ForecastWidget.tsx` | âœ… |
| 4.8 | Index exports | `src/app/_components/forecast/index.ts` | âœ… |

**Forecast Page Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ·Ğ°Ğ¿Ğ°ÑĞ¾Ğ²                      [ĞŸĞµÑ€Ğ¸Ğ¾Ğ´: 14 Ğ´Ğ½ĞµĞ¹ â–¼] [Ğ¡ĞºĞ»Ğ°Ğ´ â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸ”´ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ (3)        ğŸŸ¡ Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ (8)        ğŸŸ¢ ĞĞ¾Ñ€Ğ¼Ğ° (45)          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğº Ğ·Ğ°ĞºĞ°Ğ·Ñƒ                                    [Export CSV] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SKU       â”‚ Ğ¢Ğ¾Ğ²Ğ°Ñ€            â”‚ ĞÑÑ‚Ğ°Ñ‚Ğ¾Ğº â”‚ Ğ”Ğ¾ 0 â”‚ Ğ—Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ â”‚ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸ”´ SKU-001â”‚ Ğ‘Ğ¾Ğ»Ñ‚ Ğœ8x30       â”‚    15   â”‚ 3 Ğ´Ğ½ â”‚   100    â”‚ [Ğ—Ğ°ĞºĞ°Ğ·]â”‚  â”‚
â”‚  â”‚ ğŸ”´ SKU-045â”‚ Ğ“Ğ°Ğ¹ĞºĞ° Ğœ10        â”‚     8   â”‚ 2 Ğ´Ğ½ â”‚    50    â”‚ [Ğ—Ğ°ĞºĞ°Ğ·]â”‚  â”‚
â”‚  â”‚ ğŸŸ¡ SKU-012â”‚ Ğ¨Ğ°Ğ¹Ğ±Ğ° 12Ğ¼Ğ¼       â”‚    45   â”‚ 9 Ğ´Ğ½ â”‚   200    â”‚ [Ğ—Ğ°ĞºĞ°Ğ·]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¿Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ                                  [SKU: SKU-001 â–¼]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚      100 â”¤                                                             â”‚â”‚
â”‚  â”‚       80 â”¤     â–ˆâ–ˆâ–ˆâ–ˆ                                                    â”‚â”‚
â”‚  â”‚       60 â”¤ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                â”‚â”‚
â”‚  â”‚       40 â”¤             â–’â–’â–’â–’â–’â–’â–’â–’ (Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·)                              â”‚â”‚
â”‚  â”‚       20 â”¤                     â–’â–’â–’â–’â–’â–’â–’â–’                                â”‚â”‚
â”‚  â”‚        0 â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–’â–’ â† Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ğ°             â”‚â”‚
â”‚  â”‚          â””â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬    â”‚â”‚
â”‚  â”‚             -7d -6d -5d -4d -3d -2d -1d  0  +1d +2d +3d +4d +5d +6d    â”‚â”‚
â”‚  â”‚                      Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ          â”‚      Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                            â”‚
â”‚  ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°                                                             â”‚
â”‚  â”œâ”€ Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°ÑÑ…Ğ¾Ğ´: 12 ÑˆÑ‚/Ğ´ĞµĞ½ÑŒ                                            â”‚
â”‚  â”œâ”€ Ğ¢Ñ€ĞµĞ½Ğ´: â†—ï¸ Ğ Ğ°ÑÑ‚ÑƒÑ‰Ğ¸Ğ¹ (+15% Ğ·Ğ° Ğ¼ĞµÑÑÑ†)                                     â”‚
â”‚  â”œâ”€ Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° (MAPE): 8.5%                                        â”‚
â”‚  â””â”€ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ: 25 ÑˆÑ‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ForecastChart Component:**

```typescript
// src/app/_components/forecast/ForecastChart.tsx

import { LineChart, Line, XAxis, YAxis, Tooltip, ReferenceLine, Area } from "recharts";

interface ForecastChartProps {
  data: Array<{
    date: string;
    actual?: number;          // Ğ¤Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ)
    forecast?: number;        // ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·
    confidenceLow?: number;   // ĞĞ¸Ğ¶Ğ½ÑÑ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ğ°
    confidenceHigh?: number;  // Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°
  }>;
  reorderPoint: number;
  currentQty: number;
}

export function ForecastChart({ data, reorderPoint, currentQty }: ForecastChartProps) {
  return (
    <LineChart data={data}>
      <XAxis dataKey="date" />
      <YAxis />
      <Tooltip />
      
      {/* Ğ”Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» */}
      <Area
        type="monotone"
        dataKey="confidenceHigh"
        stroke="none"
        fill="#8884d8"
        fillOpacity={0.1}
      />
      
      {/* Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ */}
      <Line
        type="monotone"
        dataKey="actual"
        stroke="#2563eb"
        strokeWidth={2}
        dot={false}
      />
      
      {/* ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ½Ğ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ (Ğ¿ÑƒĞ½ĞºÑ‚Ğ¸Ñ€) */}
      <Line
        type="monotone"
        dataKey="forecast"
        stroke="#8884d8"
        strokeWidth={2}
        strokeDasharray="5 5"
        dot={false}
      />
      
      {/* Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ğ° */}
      <ReferenceLine
        y={reorderPoint}
        stroke="#f59e0b"
        strokeDasharray="3 3"
        label="Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ·Ğ°ĞºĞ°Ğ·Ğ°"
      />
    </LineChart>
  );
}
```

---

### 3.5 Ğ‘Ğ»Ğ¾Ğº 5: Prophet Microservice (Day 11-14)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 5.1 | Python microservice setup | `services/prophet/` | â¬œ |
| 5.2 | FastAPI endpoint | `services/prophet/main.py` | â¬œ |
| 5.3 | Prophet model wrapper | `services/prophet/forecast.py` | â¬œ |
| 5.4 | Docker setup | `services/prophet/Dockerfile` | â¬œ |
| 5.5 | Integration with Node.js | `src/server/services/prophet-client.ts` | â¬œ |
| 5.6 | Model accuracy tracking | `services/prophet/evaluation.py` | â¬œ |

**Prophet Microservice Structure:**

```
services/
â””â”€â”€ prophet/
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ main.py              # FastAPI endpoints
    â”œâ”€â”€ forecast.py          # Prophet wrapper
    â”œâ”€â”€ evaluation.py        # MAPE calculation
    â””â”€â”€ config.py
```

**FastAPI Endpoint:**

```python
# services/prophet/main.py

from fastapi import FastAPI
from prophet import Prophet
from pydantic import BaseModel
from datetime import datetime
import pandas as pd

app = FastAPI()

class ForecastRequest(BaseModel):
    sku: str
    warehouse: str
    history: list[dict]  # [{ "date": "2026-01-01", "qty": 100 }, ...]
    periods: int = 14
    include_holidays: bool = True

class ForecastResponse(BaseModel):
    sku: str
    warehouse: str
    forecasts: list[dict]
    trend: str
    seasonality: dict
    mape: float | None

@app.post("/forecast")
async def predict(request: ForecastRequest) -> ForecastResponse:
    # ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Prophet
    df = pd.DataFrame(request.history)
    df.columns = ["ds", "y"]
    df["ds"] = pd.to_datetime(df["ds"])
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
    model = Prophet(
        yearly_seasonality=True,
        weekly_seasonality=True,
        daily_seasonality=False,
    )
    
    if request.include_holidays:
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ¾ÑÑĞ¸Ğ¹ÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¸
        model.add_country_holidays(country_name="RU")
    
    model.fit(df)
    
    # ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·
    future = model.make_future_dataframe(periods=request.periods)
    forecast = model.predict(future)
    
    # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
    forecasts = []
    for _, row in forecast.tail(request.periods).iterrows():
        forecasts.append({
            "date": row["ds"].strftime("%Y-%m-%d"),
            "predictedQty": max(0, int(row["yhat"])),
            "confidenceLow": max(0, int(row["yhat_lower"])),
            "confidenceHigh": max(0, int(row["yhat_upper"])),
        })
    
    return ForecastResponse(
        sku=request.sku,
        warehouse=request.warehouse,
        forecasts=forecasts,
        trend=detect_trend(df["y"].values),
        seasonality={
            "weekly": model.weekly_seasonality,
            "yearly": model.yearly_seasonality,
        },
        mape=None,  # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    )
```

**Docker Setup:**

```dockerfile
# services/prophet/Dockerfile

FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8001

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]
```

```txt
# services/prophet/requirements.txt
fastapi==0.109.0
uvicorn==0.27.0
prophet==1.1.5
pandas==2.2.0
numpy==1.26.3
```

**Node.js Client:**

```typescript
// src/server/services/prophet-client.ts

import { env } from "~/env";

const PROPHET_URL = env.PROPHET_SERVICE_URL || "http://localhost:8001";

export interface ProphetForecastInput {
  sku: string;
  warehouse: string;
  history: Array<{ date: string; qty: number }>;
  periods?: number;
  includeHolidays?: boolean;
}

export async function getProphetForecast(input: ProphetForecastInput) {
  const response = await fetch(`${PROPHET_URL}/forecast`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      sku: input.sku,
      warehouse: input.warehouse,
      history: input.history,
      periods: input.periods ?? 14,
      include_holidays: input.includeHolidays ?? true,
    }),
  });

  if (!response.ok) {
    throw new Error(`Prophet service error: ${response.statusText}`);
  }

  return response.json();
}
```

---

### 3.6 Ğ‘Ğ»Ğ¾Ğº 6: Proactive Alerts (Day 15)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 6.1 | Forecast-based alerts | `src/server/services/alert-service.ts` | â¬œ |
| 6.2 | Daily reorder digest email | `src/server/services/notification-service.ts` | â¬œ |
| 6.3 | Scheduled forecast job | `scripts/forecast-worker.ts` | âœ… |
| 6.4 | Alert rule: "days_to_stockout" | Extend AlertRule model | â¬œ |

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ°Ğ»ĞµÑ€Ñ‚Ğ°:**

```prisma
// Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ AlertRule Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ½Ñ‹Ñ… Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²
model AlertRule {
  // ... existing fields ...
  
  // ĞĞ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ´Ğ»Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°
  forecastCondition String? @map("forecast_condition") @db.VarChar(30)
  // "days_to_stockout_below", "trend_increasing", "trend_decreasing"
  
  forecastThreshold Int? @map("forecast_threshold")
  // Ğ”Ğ»Ñ days_to_stockout: ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹
}
```

**Daily Digest Email Template:**

```
ğŸ“¦ Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ğ¼ | AI Stock Keeper
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ (Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SKU-001  Ğ‘Ğ¾Ğ»Ñ‚ Ğœ8x30     â”‚ Ğ”Ğ¾ 0: 2 Ğ´Ğ½Ñ â”‚ 100 â”‚
â”‚ SKU-045  Ğ“Ğ°Ğ¹ĞºĞ° Ğœ10      â”‚ Ğ”Ğ¾ 0: 3 Ğ´Ğ½Ñ â”‚  50 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸŸ¡ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ• (Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SKU-012  Ğ¨Ğ°Ğ¹Ğ±Ğ° 12Ğ¼Ğ¼     â”‚ Ğ”Ğ¾ 0: 8 Ğ´Ğ½ĞµĞ¹ â”‚ 200â”‚
â”‚ SKU-033  Ğ’Ğ¸Ğ½Ñ‚ 6x20      â”‚ Ğ”Ğ¾ 0: 9 Ğ´Ğ½ĞµĞ¹ â”‚ 150â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹: â‚½45,600

[ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Dashboard] [Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Excel]
```

---

### 3.7 Ğ‘Ğ»Ğ¾Ğº 7: Backend API (Day 11-14)

| ID | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|----------|----------|--------|
| 7.1 | `forecast.getForProduct` | ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° | âœ… |
| 7.2 | `forecast.getBatch` | ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹ Ğ´Ğ»Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² | âœ… |
| 7.3 | `forecast.getRecommendations` | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ´Ğ¾Ğ·Ğ°ĞºĞ°Ğ·Ñƒ | âœ… |
| 7.4 | `forecast.approveRecommendation` | ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ | âœ… |
| 7.5 | `forecast.getConsumptionTrend` | Ğ¢Ñ€ĞµĞ½Ğ´ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ | âœ… |
| 7.6 | `forecast.getAccuracy` | Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ² (MAPE) | âœ… |
| 7.7 | `forecast.getSettings` | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ | â¬œ |
| 7.8 | `forecast.updateSettings` | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ | â¬œ |

**tRPC Router:**

```typescript
// src/server/api/routers/forecast.ts

export const forecastRouter = createTRPCRouter({
  // ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
  getForProduct: publicProcedure
    .input(z.object({
      sku: z.string(),
      warehouse: z.string(),
      days: z.number().min(7).max(90).default(14),
      model: z.enum(["sma", "ema", "prophet"]).default("sma"),
    }))
    .query(async ({ input }) => {
      const forecast = await forecastService.forecast(input);
      return forecast;
    }),

  // Ğ’ÑĞµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
  getRecommendations: publicProcedure
    .input(z.object({
      warehouse: z.string().optional(),
      urgency: z.enum(["critical", "warning", "normal"]).optional(),
      limit: z.number().default(50),
    }))
    .query(async ({ input }) => {
      return reorderService.getRecommendations(input);
    }),

  // ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ
  approveRecommendation: publicProcedure
    .input(z.object({
      id: z.number(),
      orderQty: z.number().optional(),
    }))
    .mutation(async ({ input }) => {
      return reorderService.approve(input.id, input.orderQty);
    }),

  // Ğ¢Ñ€ĞµĞ½Ğ´ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ
  getConsumptionTrend: publicProcedure
    .input(z.object({
      sku: z.string(),
      warehouse: z.string(),
      days: z.number().default(30),
    }))
    .query(async ({ input }) => {
      return consumptionService.getTrend(input);
    }),

  // Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ²
  getAccuracy: publicProcedure
    .input(z.object({
      model: z.enum(["sma", "ema", "prophet"]).optional(),
      days: z.number().default(30),
    }))
    .query(async ({ input }) => {
      return forecastService.getAccuracy(input);
    }),
});
```

---

### 3.8 Ğ‘Ğ»Ğ¾Ğº 8: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Day 15)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¢Ğ¸Ğ¿ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-----|--------|
| 8.1 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ForecastService | Jest | âœ… (22 Ñ‚ĞµÑÑ‚Ğ¾Ğ²) |
| 8.2 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ReorderService | Jest | âœ… (13 Ñ‚ĞµÑÑ‚Ğ¾Ğ²) |
| 8.3 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ConsumptionService | Jest | â¬œ |
| 8.4 | Integration Ñ‚ĞµÑÑ‚ forecast flow | Jest | â¬œ |
| 8.5 | Prophet microservice tests | pytest | â¬œ |
| 8.6 | A/B Ñ‚ĞµÑÑ‚: SMA vs EMA vs Prophet | Manual | â¬œ |
| 8.7 | Forecast accuracy benchmark | Manual | â¬œ |

**Test Cases:**

```typescript
// src/__tests__/unit/forecast.test.ts

describe("ForecastService", () => {
  describe("SMA", () => {
    it("should calculate correct moving average", () => {
      const data = [10, 20, 30, 40, 50];
      const sma = forecastService.calculateSMA(data, 3);
      expect(sma).toBe(40); // (30 + 40 + 50) / 3
    });

    it("should handle window larger than data", () => {
      const data = [10, 20];
      const sma = forecastService.calculateSMA(data, 5);
      expect(sma).toBe(15); // (10 + 20) / 2
    });
  });

  describe("EMA", () => {
    it("should weight recent data more", () => {
      const data = [10, 10, 10, 100]; // Spike at end
      const ema = forecastService.calculateEMA(data, 0.5);
      expect(ema).toBeGreaterThan(30); // Should be pulled toward 100
    });
  });

  describe("Trend Detection", () => {
    it("should detect increasing trend", () => {
      const data = [10, 15, 20, 25, 30];
      expect(forecastService.detectTrend(data)).toBe("increasing");
    });

    it("should detect decreasing trend", () => {
      const data = [30, 25, 20, 15, 10];
      expect(forecastService.detectTrend(data)).toBe("decreasing");
    });

    it("should detect stable trend", () => {
      const data = [20, 21, 19, 20, 21];
      expect(forecastService.detectTrend(data)).toBe("stable");
    });

    it("should return stable for empty array", () => {
      expect(forecastService.detectTrend([])).toBe("stable");
    });

    it("should return stable for single data point", () => {
      expect(forecastService.detectTrend([100])).toBe("stable");
    });

    it("should handle two data points", () => {
      expect(forecastService.detectTrend([10, 20])).toBe("increasing");
      expect(forecastService.detectTrend([20, 10])).toBe("decreasing");
    });
  });

  describe("Days to Stockout", () => {
    it("should calculate correctly", () => {
      expect(forecastService.daysToStockout(100, 10)).toBe(10);
      expect(forecastService.daysToStockout(50, 7)).toBe(7);
    });

    it("should return Infinity for zero consumption", () => {
      expect(forecastService.daysToStockout(100, 0)).toBe(Infinity);
    });
  });
});
```

---

## 4. Environment Variables

```env
# Prophet Microservice
PROPHET_SERVICE_URL=http://localhost:8001

# Forecast defaults
FORECAST_DEFAULT_HISTORY_DAYS=60
FORECAST_DEFAULT_PERIODS=14
FORECAST_DEFAULT_MODEL=sma

# Reorder defaults
REORDER_DEFAULT_LEAD_TIME_DAYS=7
REORDER_DEFAULT_SERVICE_LEVEL=0.95
REORDER_MIN_ORDER_QTY=10
```

---

## 5. Ğ¢Ğ°Ğ¹Ğ¼Ğ»Ğ°Ğ¹Ğ½

```
Week 1 (Days 1-5) - MVP Forecasting
â”œâ”€â”€ Day 1: ConsumptionService, Prisma models
â”œâ”€â”€ Day 2: Data aggregation job
â”œâ”€â”€ Day 3: ForecastService (SMA)
â”œâ”€â”€ Day 4: ForecastService (EMA), trend detection
â””â”€â”€ Day 5: tRPC endpoints, unit tests

Week 2 (Days 6-10) - Reorder & UI
â”œâ”€â”€ Day 6: ReorderService
â”œâ”€â”€ Day 7: Safety stock, EOQ calculations
â”œâ”€â”€ Day 8: Forecast page UI
â”œâ”€â”€ Day 9: ForecastChart, ReorderTable
â””â”€â”€ Day 10: Dashboard integration, settings

Week 3 (Days 11-15) - Prophet & Polish
â”œâ”€â”€ Day 11: Prophet microservice setup
â”œâ”€â”€ Day 12: FastAPI endpoints
â”œâ”€â”€ Day 13: Node.js integration
â”œâ”€â”€ Day 14: Proactive alerts, daily digest
â””â”€â”€ Day 15: Testing, documentation
```

---

## 6. Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ forecast/
â”‚   â”‚   â””â”€â”€ page.tsx                    # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ²
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ forecast/
â”‚   â”‚       â””â”€â”€ page.tsx                # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚   â””â”€â”€ _components/
â”‚       â””â”€â”€ forecast/
â”‚           â”œâ”€â”€ index.ts
â”‚           â”œâ”€â”€ ForecastChart.tsx       # Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°
â”‚           â”œâ”€â”€ ReorderTable.tsx        # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹
â”‚           â”œâ”€â”€ ProductForecastCard.tsx # ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
â”‚           â”œâ”€â”€ TrendIndicator.tsx      # Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ‚Ñ€ĞµĞ½Ğ´Ğ°
â”‚           â””â”€â”€ AccuracyBadge.tsx       # Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ consumption-service.ts      # ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ forecast-service.ts         # SMA, EMA, Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ reorder-service.ts          # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”‚   â””â”€â”€ prophet-client.ts           # ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Prophet API
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ routers/
â”‚           â””â”€â”€ forecast.ts             # tRPC router
â”œâ”€â”€ __tests__/
â”‚   â””â”€â”€ unit/
â”‚       â”œâ”€â”€ consumption.test.ts
â”‚       â”œâ”€â”€ forecast.test.ts
â”‚       â””â”€â”€ reorder.test.ts
â””â”€â”€ scripts/
    â”œâ”€â”€ aggregate-consumption.ts        # Cron job
    â””â”€â”€ forecast-worker.ts              # Background worker

services/
â””â”€â”€ prophet/
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ main.py
    â”œâ”€â”€ forecast.py
    â””â”€â”€ config.py
```

---

## 7. ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ°

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ¦ĞµĞ»ÑŒ | Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ |
|---------|------|-----------|
| **MAPE (SMA)** | < 20% | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ½Ğ° 7 Ğ´Ğ½ĞµĞ¹ |
| **MAPE (Prophet)** | < 12% | Ğ¢Ğ¾ Ğ¶Ğµ Ñ Prophet |
| **Stockout Reduction** | -50% | Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾/Ğ¿Ğ¾ÑĞ»Ğµ |
| **Recommendation Accuracy** | > 80% | % Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ñ‹Ñ… Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹ |
| **Forecast Page Load** | < 2 ÑĞµĞº | First Contentful Paint |
| **Prophet Latency** | < 5 ÑĞµĞº | Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° microservice |

---

## 8. Ğ Ğ¸ÑĞºĞ¸ Ğ¸ Ğ¼Ğ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸

| Ğ Ğ¸ÑĞº | Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ | ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ |
|------|-------------|---------|-----------|
| ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ | Fallback Ğ½Ğ° SMA Ñ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¼ Ğ¾ĞºĞ½Ğ¾Ğ¼ |
| Prophet ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, batch processing |
| ĞĞµÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹ Ğ´Ğ»Ñ new products | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ-Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³ |
| Ğ¡ĞµĞ·Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ½Ğµ ÑƒÑ‡Ñ‚ĞµĞ½Ğ° | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Prophet Ñ holidays |
| ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒÑÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Email digests, urgency levels |

---

## 9. Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… Ñ„Ğ°Ğ·

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Phase 4 |
|-----------|-------------------------|
| `Transaction` model | Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ |
| `Inventory` model | Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ |
| `AlertService` | Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ forecast alerts |
| `NotificationService` | Daily digest emails |
| `InventoryCache` | Real-time Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |
| `Dashboard` | ForecastWidget Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ |

---

## 10. Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Phase 4:
- [ ] **Phase 5:** Picking Optimization (TSP solver)
- [ ] **Phase 6:** Multi-Warehouse Sync
- [ ] **Future:** AutoML Ğ´Ğ»Ñ enterprise
- [ ] **Future:** Supplier API integration

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½:** 2026-01-31  
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2026-01-31  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ğŸ“‹ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ  
**ĞĞ²Ñ‚Ğ¾Ñ€:** AI Stock Keeper Team
