# Phase 2: Goods Intake with OCR

**Ğ¦ĞµĞ»ÑŒ:** MVP â€” Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ñ AI-Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼  
**Ğ¡Ñ€Ğ¾Ğº:** 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ğŸš§ Ğ’ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ (Ğ‘Ğ»Ğ¾ĞºĞ¸ 1-3 Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹)  
**ĞĞ°Ñ‡Ğ°Ğ»Ğ¾:** ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Phase 1

---

## 1. ĞĞ±Ğ·Ğ¾Ñ€

### 1.1 Deliverable
Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² â†’ Ğ°Ğ²Ñ‚Ğ¾Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ñ€Ğ¼ â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² 1C

### 1.2 User Story
```
ĞšĞ°Ğº ÑĞºĞ»Ğ°Ğ´ÑĞºĞ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ½Ğ¸Ğº,
Ñ Ñ…Ğ¾Ñ‡Ñƒ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑˆÑ‚Ñ€Ğ¸Ñ…-ĞºĞ¾Ğ´ Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹,
Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ½ÑƒÑ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½ÑƒÑ Ğ² 1C
Ğ±ĞµĞ· Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
```

### 1.3 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Intake Flow                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“· Camera/Upload  â†’  ğŸ” Recognition  â†’  ğŸ” Matching  â†’  âœ… Confirm  â†’  ğŸ“„ 1C Doc
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ Quagga.js    â”‚   â”‚ Tesseract.js â”‚   â”‚ Fuse.js      â”‚   â”‚ tRPC API     â”‚
â”‚  â”‚ (barcode)    â”‚   â”‚ (OCR text)   â”‚   â”‚ (fuzzy)      â”‚   â”‚ (1C client)  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Tech Stack

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-----------|------------|--------|----------|
| **Barcode Scanner** | `@ericblade/quagga2` | ^1.8.x | EAN-13, Code128, Code39, live camera |
| **OCR Engine** | `tesseract.js` | ^5.x | Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñ‹ |
| **Fuzzy Matching** | `fuse.js` | ^7.x | ĞĞµÑ‡Ñ‘Ñ‚ĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² |
| **UI Components** | `shadcn/ui` | latest | ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° |
| **Camera Access** | Web API | - | `navigator.mediaDevices.getUserMedia()` |

### 2.1 ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¸ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

**Quagga.js:**
- Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾, open-source
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²ÑĞµÑ… Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ² ÑˆÑ‚Ñ€Ğ¸Ñ…-ĞºĞ¾Ğ´Ğ¾Ğ²
- Live scanning Ñ ĞºĞ°Ğ¼ĞµÑ€Ñ‹
- ~80% accuracy (Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ MVP)

**Tesseract.js:**
- Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ° (ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğ°)
- ~85-90% accuracy
- ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¾ Google Vision API Ğ¿Ğ¾Ğ·Ğ¶Ğµ

**Fuse.js:**
- Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ fuzzy search
- ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ threshold
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñ‹
- Ğ’Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»ÑĞ¼

---

## 3. Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸

### 3.1 Ğ‘Ğ»Ğ¾Ğº 1: Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Day 1-2) âœ…

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 1.1 | Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ | `package.json` | âœ… |
| 1.2 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ BarcodeService | `src/server/services/barcode.ts` | âœ… |
| 1.3 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ OCRService | `src/server/services/ocr.ts` | âœ… |
| 1.4 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ProductMatcherService | `src/server/services/product-matcher.ts` | âœ… |
| 1.5 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² | `src/__tests__/unit/` | âœ… |

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸:**
```bash
npm install @ericblade/quagga2 tesseract.js fuse.js
npm install --save-dev @types/quagga
```

---

### 3.2 Ğ‘Ğ»Ğ¾Ğº 2: UI ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ (Day 3-5) âœ…

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|------|--------|
| 2.1 | BarcodeScanner ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | `src/app/_components/intake/BarcodeScanner.tsx` | âœ… |
| 2.2 | ImageUploader ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | `src/app/_components/intake/ImageUploader.tsx` | âœ… |
| 2.3 | ProductSuggestions ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | `src/app/_components/intake/ProductSuggestions.tsx` | âœ… |
| 2.4 | IntakeForm ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | `src/app/_components/intake/IntakeForm.tsx` | âœ… |
| 2.5 | IntakeConfirmation ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | `src/app/_components/intake/IntakeConfirmation.tsx` | âœ… |

---

### 3.3 Ğ‘Ğ»Ğ¾Ğº 3: Backend API (Day 6-7) âœ…

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Endpoint | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|----------|--------|
| 3.1 | Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ ÑˆÑ‚Ñ€Ğ¸Ñ…-ĞºĞ¾Ğ´ | `intake.recognizeBarcode` | âœ… |
| 3.2 | Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ (OCR) | `intake.recognizeOCR` | âœ… |
| 3.3 | ĞĞ°Ğ¹Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñƒ | `intake.matchProduct` | âœ… |
| 3.4 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ½ÑƒÑ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½ÑƒÑ | `intake.createReceipt` | âœ… |
| 3.5 | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğº | `intake.getHistory` | âœ… |
| 3.6 | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ | `intake.getStats` | âœ… |

**tRPC Router:**
```typescript
// src/server/api/routers/intake.ts
export const intakeRouter = createTRPCRouter({
  recognizeBarcode: publicProcedure
    .input(z.object({ imageBase64: z.string() }))
    .mutation(async ({ input }) => { ... }),

  recognizeOCR: publicProcedure
    .input(z.object({ imageBase64: z.string(), language: z.string().default('rus') }))
    .mutation(async ({ input }) => { ... }),

  matchProduct: publicProcedure
    .input(z.object({ query: z.string(), limit: z.number().default(5) }))
    .query(async ({ input }) => { ... }),

  createReceipt: publicProcedure
    .input(z.object({
      items: z.array(z.object({ sku: z.string(), quantity: z.number() })),
      warehouse: z.string(),
    }))
    .mutation(async ({ input }) => { ... }),

  getHistory: publicProcedure
    .input(z.object({ limit: z.number().default(20), offset: z.number().default(0) }))
    .query(async ({ input }) => { ... }),
});
```

---

### 3.4 Ğ‘Ğ»Ğ¾Ğº 4: Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (Day 8-9) âœ…

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Route | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-------|--------|
| 4.1 | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ĞºĞ¸ | `/intake` | âœ… |
| 4.2 | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğº | `/intake/history` | âœ… |

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ `/intake`:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ĞŸÑ€Ğ¸Ñ‘Ğ¼ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“· ĞšĞ°Ğ¼ĞµÑ€Ğ°    â”‚  â”‚ ğŸ“ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ â”‚   â”‚
â”‚  â”‚              â”‚  â”‚    Ñ„Ğ°Ğ¹Ğ»      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´: EAN-4607001234567   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹:                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ“ SKU-001 Ğ‘Ğ¾Ğ»Ñ‚ Ğœ8x30    (98%)  â”‚   â”‚
â”‚  â”‚   SKU-002 Ğ‘Ğ¾Ğ»Ñ‚ Ğœ8x25    (72%)  â”‚   â”‚
â”‚  â”‚   SKU-003 Ğ‘Ğ¾Ğ»Ñ‚ Ğœ10x30   (65%)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾: [____100____]             â”‚
â”‚  Ğ¡ĞºĞ»Ğ°Ğ´:      [warehouse_main â–¼]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ĞÑ‚Ğ¼ĞµĞ½Ğ° ]          [ âœ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.5 Ğ‘Ğ»Ğ¾Ğº 5: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Day 10)

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¢Ğ¸Ğ¿ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|----|--------|-----|--------|
| 5.1 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ BarcodeService | Jest | â¬œ |
| 5.2 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ OCRService | Jest | â¬œ |
| 5.3 | Unit-Ñ‚ĞµÑÑ‚Ñ‹ ProductMatcher | Jest | â¬œ |
| 5.4 | Integration Ñ‚ĞµÑÑ‚ intake flow | Jest | â¬œ |
| 5.5 | Manual E2E Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ | Manual | â¬œ |

---

## 4. Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸

### 4.1 BarcodeService

```typescript
// src/server/services/barcode.ts

interface BarcodeResult {
  code: string;
  format: 'ean_13' | 'code_128' | 'code_39' | 'qr_code' | 'unknown';
  confidence: number; // 0-100
}

export class BarcodeService {
  /**
   * Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ ÑˆÑ‚Ñ€Ğ¸Ñ…-ĞºĞ¾Ğ´ Ğ¸Ğ· base64 Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
   */
  async recognize(imageBase64: string): Promise<BarcodeResult | null>;

  /**
   * ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ÑĞºĞ°Ğ½ĞµÑ€Ğ°
   */
  configure(options: QuaggaConfig): void;
}
```

### 4.2 OCRService

```typescript
// src/server/services/ocr.ts

interface OCRResult {
  text: string;
  confidence: number; // 0-100
  words: Array<{
    text: string;
    confidence: number;
    bbox: { x0: number; y0: number; x1: number; y1: number };
  }>;
}

export class OCRService {
  /**
   * Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· base64 Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
   */
  async recognize(imageBase64: string, language?: string): Promise<OCRResult>;

  /**
   * Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (SKU, ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾)
   */
  async extractProductData(text: string): Promise<{
    sku?: string;
    name?: string;
    quantity?: number;
  }>;
}
```

### 4.3 ProductMatcherService

```typescript
// src/server/services/product-matcher.ts

interface MatchResult {
  item: {
    sku: string;
    name: string;
    warehouse: string;
  };
  score: number; // 0-1 (1 = perfect match)
  confidence: number; // 0-100%
}

export class ProductMatcherService {
  /**
   * ĞĞ°Ğ¹Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ
   */
  async search(query: string, limit?: number): Promise<MatchResult[]>;

  /**
   * ĞĞ°Ğ¹Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ¼Ñƒ SKU
   */
  async findBySku(sku: string): Promise<MatchResult | null>;

  /**
   * ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ¸Ğ· Ğ‘Ğ”
   */
  async refreshIndex(): Promise<void>;
}
```

---

## 5. Ğ¢Ğ°Ğ¹Ğ¼Ğ»Ğ°Ğ¹Ğ½

```
Week 1 (Days 1-5)
â”œâ”€â”€ Day 1: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹, BarcodeService
â”œâ”€â”€ Day 2: OCRService, ProductMatcherService
â”œâ”€â”€ Day 3: BarcodeScanner UI, ImageUploader UI
â”œâ”€â”€ Day 4: ProductSuggestions UI, IntakeForm UI
â””â”€â”€ Day 5: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

Week 2 (Days 6-10)
â”œâ”€â”€ Day 6: tRPC Router (intake)
â”œâ”€â”€ Day 7: API Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ UI
â”œâ”€â”€ Day 8: Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° /intake
â”œâ”€â”€ Day 9: Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° /intake/history, UX polish
â””â”€â”€ Day 10: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
```

---

## 6. Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ _components/
â”‚   â”‚   â””â”€â”€ intake/
â”‚   â”‚       â”œâ”€â”€ BarcodeScanner.tsx
â”‚   â”‚       â”œâ”€â”€ ImageUploader.tsx
â”‚   â”‚       â”œâ”€â”€ ProductSuggestions.tsx
â”‚   â”‚       â”œâ”€â”€ IntakeForm.tsx
â”‚   â”‚       â””â”€â”€ IntakeConfirmation.tsx
â”‚   â””â”€â”€ intake/
â”‚       â”œâ”€â”€ page.tsx
â”‚       â””â”€â”€ history/
â”‚           â””â”€â”€ page.tsx
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routers/
â”‚   â”‚       â””â”€â”€ intake.ts
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ barcode.ts
â”‚       â”œâ”€â”€ ocr.ts
â”‚       â””â”€â”€ product-matcher.ts
â””â”€â”€ __tests__/
    â””â”€â”€ unit/
        â”œâ”€â”€ barcode.test.ts
        â”œâ”€â”€ ocr.test.ts
        â””â”€â”€ product-matcher.test.ts
```

---

## 7. ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ°

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ¦ĞµĞ»ÑŒ | Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ |
|---------|------|-----------|
| **Barcode accuracy** | >80% | % ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğ¹ |
| **OCR accuracy** | >85% | % ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡Ñ‘Ğ½Ğ½Ñ‹Ñ… SKU |
| **Product match rate** | >90% | % Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹ Ğ² top-3 |
| **Intake time** | <30 sec | Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ ÑĞºĞ°Ğ½Ğ° Ğ´Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² 1C |
| **Error rate** | <5% | % Ğ½ĞµÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğº |

---

## 8. Ğ Ğ¸ÑĞºĞ¸ Ğ¸ Ğ¼Ğ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸

| Ğ Ğ¸ÑĞº | Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ | ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ |
|------|-------------|---------|-----------|
| ĞĞ¸Ğ·ĞºĞ°Ñ accuracy OCR | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ | Manual override, Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… |
| ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ ĞºĞ°Ğ¼ĞµÑ€Ğ¾Ğ¹ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Fallback Ğ½Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ° |
| ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Tesseract.js | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Web Worker, loading indicator |
| ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ² Ğ‘Ğ” | ĞĞ¸Ğ·ĞºĞ°Ñ | ĞĞ¸Ğ·ĞºĞ¾Ğµ | UI Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° |

---

## 9. Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Phase 1

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Phase 1 | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Phase 2 |
|-------------------|-------------------------|
| `OneCClient` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ñ‹Ñ… |
| `InventoryCache` | ĞŸĞ¾Ğ¸ÑĞº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ matching |
| `db.inventory` | Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Fuse.js |
| tRPC setup | ĞĞ¾Ğ²Ñ‹Ğ¹ router `intake` |

---

## 10. Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Phase 2:
- [ ] **Phase 3:** Real-Time Inventory Sync (Dashboard)
- [ ] **Future:** Google Vision API Ğ´Ğ»Ñ production OCR
- [ ] **Future:** ML model Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ matching

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½:** 2026-01-31  
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2026-01-31  
**ĞĞ²Ñ‚Ğ¾Ñ€:** AI Stock Keeper Team
